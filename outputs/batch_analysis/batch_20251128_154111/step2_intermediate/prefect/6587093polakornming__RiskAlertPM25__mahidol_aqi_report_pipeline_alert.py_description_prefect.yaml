metadata:
  target_orchestrator: prefect
  generated_at: 2025-11-28 15:42:26.418816
  source_analysis_file: 
    Pipeline_Description_Dataset/6587093polakornming__RiskAlertPM25__mahidol_aqi_report_pipeline_alert.py_description.txt
  pipeline_name: PM2.5_Risk_Alert_Pipeline
  pipeline_description: Comprehensive ETL pipeline that scrapes Mahidol University AQI data, processes HTML to extract 
    air quality metrics, loads data into PostgreSQL, and sends email alerts when PM2.5 levels exceed safe thresholds
  orchestrator_specific:
    flow_name: pm2.5_risk_alert_pipeline
    deployment_name: pm2.5_risk_alert_pipeline_deployment
    work_pool: default-agent-pool
    task_runner: SequentialTaskRunner
    prefect_version: 2.14.0
schedule:
  enabled: false
  schedule_expression:
  start_date:
  end_date:
  timezone: UTC
  catchup: false
connections:
  - conn_id: mahidol_aqi_website
    conn_type: Secret
    description: Mahidol University AQI Website
    config:
      block_type: Secret
      block_module: prefect.blocks.system
      block_name: mahidol_aqi_website
      config:
        base_url: https://mahidol.ac.th/aqireport/
        host:
        port:
        protocol: https
        database:
        schema:
        bucket:
        queue_name:
        base_path:
  - conn_id: local_filesystem_data
    conn_type: LocalFileSystem
    description: Local Filesystem Data Storage
    config:
      block_type: LocalFileSystem
      block_module: prefect.filesystems
      block_name: local_filesystem_data
      config:
        base_path: data
        base_url:
        host:
        port:
        protocol: file
        database:
        schema:
        bucket:
        queue_name:
  - conn_id: postgres_data_warehouse
    conn_type: Secret
    description: PostgreSQL Data Warehouse
    config:
      block_type: Secret
      block_module: prefect.blocks.system
      block_name: postgres_data_warehouse
      config:
        base_path:
        base_url:
        host:
        port:
        protocol: jdbc
        database:
        schema:
        bucket:
        queue_name:
  - conn_id: gmail_smtp_server
    conn_type: Secret
    description: Gmail SMTP Server
    config:
      block_type: Secret
      block_module: prefect.blocks.system
      block_name: gmail_smtp_server
      config:
        base_url:
        host: smtp.gmail.com
        port: 587
        protocol: smtp
        database:
        schema:
        bucket:
        queue_name:
        base_path:
        username_secret_name: EMAIL_USERNAME
        password_secret_name: EMAIL_PASSWORD
  - conn_id: local_config_files
    conn_type: LocalFileSystem
    description: Local Configuration Files
    config:
      block_type: LocalFileSystem
      block_module: prefect.filesystems
      block_name: local_config_files
      config:
        base_path: /opt/airflow/config
        base_url:
        host:
        port:
        protocol: file
        database:
        schema:
        bucket:
        queue_name:
tasks:
  - task_id: extract_mahidol_aqi_html
    task_name: Extract Mahidol AQI HTML
    operator_class: Process
    operator_module: prefect.infrastructure.process
    component_ref: extract_mahidol_aqi_html
    config:
      task_decorator: '@task'
      infrastructure:
        type: Process
        module: prefect.infrastructure.process
        config: {}
      retries: 3
      retry_delay_seconds: 5
    upstream_task_ids: []
    trigger_rule: wait_for='all'
    retries: 3
    retry_delay_seconds: 5
    validation_warnings: []
  - task_id: parse_aqi_html_to_json
    task_name: Parse AQI HTML to JSON
    operator_class: Process
    operator_module: prefect.infrastructure.process
    component_ref: parse_aqi_html_to_json
    config:
      task_decorator: '@task'
      infrastructure:
        type: Process
        module: prefect.infrastructure.process
        config: {}
      retries: 3
      retry_delay_seconds: 5
    upstream_task_ids:
      - extract_mahidol_aqi_html
    trigger_rule: wait_for='all'
    retries: 3
    retry_delay_seconds: 5
    validation_warnings: []
  - task_id: load_aqi_data_to_postgres
    task_name: Load AQI Data to PostgreSQL
    operator_class: Process
    operator_module: prefect.infrastructure.process
    component_ref: load_aqi_data_to_postgres
    config:
      task_decorator: '@task'
      infrastructure:
        type: Process
        module: prefect.infrastructure.process
        config: {}
      retries: 3
      retry_delay_seconds: 10
    upstream_task_ids:
      - parse_aqi_html_to_json
    trigger_rule: wait_for='all'
    retries: 3
    retry_delay_seconds: 10
    validation_warnings: []
  - task_id: send_aqi_alert_email
    task_name: Send AQI Alert Email
    operator_class: Process
    operator_module: prefect.infrastructure.process
    component_ref: send_aqi_alert_email
    config:
      task_decorator: '@task'
      infrastructure:
        type: Process
        module: prefect.infrastructure.process
        config: {}
      retries: 2
      retry_delay_seconds: 30
    upstream_task_ids:
      - load_aqi_data_to_postgres
    trigger_rule: wait_for='all'
    retries: 2
    retry_delay_seconds: 30
    validation_warnings: []
