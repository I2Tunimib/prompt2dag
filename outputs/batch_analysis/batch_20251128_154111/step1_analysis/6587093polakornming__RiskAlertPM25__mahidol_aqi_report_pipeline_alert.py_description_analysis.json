{
  "metadata": {
    "schema_version": "1.0",
    "analysis_timestamp": "2025-11-28T15:42:25.692049",
    "source_file": "Pipeline_Description_Dataset/6587093polakornming__RiskAlertPM25__mahidol_aqi_report_pipeline_alert.py_description.txt",
    "llm_provider": "deepinfra",
    "llm_model": "Qwen3-Coder",
    "analysis_results": {
      "detected_patterns": [
        "sequential",
        "branching"
      ],
      "task_executors_used": [
        "python",
        "http",
        "sql"
      ],
      "has_branching": true,
      "has_parallelism": false,
      "has_sensors": false,
      "total_components": 4,
      "complexity_score": "low"
    },
    "orchestrator_compatibility": {
      "airflow": {
        "supported": true,
        "confidence": "high",
        "notes": [
          "Sequential pattern fully supported",
          "Branching via BranchPythonOperator"
        ]
      },
      "prefect": {
        "supported": true,
        "confidence": "high",
        "notes": [
          "Sequential flow with task dependencies",
          "Conditional logic via Python control flow"
        ]
      },
      "dagster": {
        "supported": true,
        "confidence": "high",
        "notes": [
          "Op graph with dependencies",
          "Dynamic graphs or branching ops"
        ]
      }
    },
    "validation_warnings": []
  },
  "pipeline_summary": {
    "name": "PM2.5_Risk_Alert_Pipeline",
    "description": "Comprehensive ETL pipeline that scrapes Mahidol University AQI data, processes HTML to extract air quality metrics, loads data into PostgreSQL, and sends email alerts when PM2.5 levels exceed safe thresholds",
    "flow_patterns": [
      "sequential",
      "branching"
    ],
    "task_executors": [
      "python",
      "http",
      "sql"
    ],
    "complexity": "low"
  },
  "components": [
    {
      "id": "extract_mahidol_aqi_html",
      "name": "Extract Mahidol AQI HTML",
      "category": "Extractor",
      "description": "Scrapes current AQI data from Mahidol University website and saves as HTML file. Implements atomic file write pattern using temporary file then rename.",
      "inputs": [
        "https://mahidol.ac.th/aqireport/"
      ],
      "outputs": [
        "data/mahidol_aqi.html"
      ],
      "executor_type": "python",
      "executor_config": {
        "image": null,
        "command": null,
        "script_path": null,
        "entry_point": null,
        "environment": {},
        "resources": {
          "cpu": null,
          "memory": null,
          "gpu": null
        },
        "network": null
      },
      "io_spec": [
        {
          "name": "mahidol_aqi_website",
          "direction": "input",
          "kind": "api",
          "format": "html",
          "path_pattern": "https://mahidol.ac.th/aqireport/",
          "connection_id": null
        },
        {
          "name": "html_output",
          "direction": "output",
          "kind": "file",
          "format": "html",
          "path_pattern": "data/mahidol_aqi.html",
          "connection_id": null
        }
      ],
      "upstream_policy": {
        "type": "all_success",
        "description": "Initial step in pipeline",
        "timeout_seconds": null
      },
      "retry_policy": {
        "max_attempts": 3,
        "delay_seconds": 5,
        "exponential_backoff": true,
        "retry_on": [
          "timeout",
          "network_error"
        ]
      },
      "concurrency": {
        "supports_parallelism": false,
        "supports_dynamic_mapping": false,
        "map_over_param": null,
        "max_parallel_instances": null
      },
      "connections": [],
      "datasets": {
        "consumes": [],
        "produces": [
          "mahidol_aqi_html"
        ]
      }
    },
    {
      "id": "parse_aqi_html_to_json",
      "name": "Parse AQI HTML to JSON",
      "category": "Transformer",
      "description": "Parses HTML content to extract structured AQI data and validates data freshness. Includes duplicate detection by checking factmahidolaqitable, raises exception if data already exists.",
      "inputs": [
        "data/mahidol_aqi.html",
        "existing JSON file for comparison"
      ],
      "outputs": [
        "data/tmp_mahidol.json"
      ],
      "executor_type": "python",
      "executor_config": {
        "image": null,
        "command": null,
        "script_path": null,
        "entry_point": null,
        "environment": {},
        "resources": {
          "cpu": null,
          "memory": null,
          "gpu": null
        },
        "network": null
      },
      "io_spec": [
        {
          "name": "html_input",
          "direction": "input",
          "kind": "file",
          "format": "html",
          "path_pattern": "data/mahidol_aqi.html",
          "connection_id": null
        },
        {
          "name": "json_output",
          "direction": "output",
          "kind": "file",
          "format": "json",
          "path_pattern": "data/tmp_mahidol.json",
          "connection_id": null
        }
      ],
      "upstream_policy": {
        "type": "all_success",
        "description": "Requires successful completion of extract_mahidol_aqi_html",
        "timeout_seconds": null
      },
      "retry_policy": {
        "max_attempts": 3,
        "delay_seconds": 5,
        "exponential_backoff": true,
        "retry_on": [
          "parsing_error",
          "validation_error"
        ]
      },
      "concurrency": {
        "supports_parallelism": false,
        "supports_dynamic_mapping": false,
        "map_over_param": null,
        "max_parallel_instances": null
      },
      "connections": [
        {
          "id": "postgres_conn",
          "type": "database",
          "purpose": "Check for duplicate data in factmahidolaqitable"
        }
      ],
      "datasets": {
        "consumes": [
          "mahidol_aqi_html"
        ],
        "produces": [
          "mahidol_aqi_json"
        ]
      }
    },
    {
      "id": "load_aqi_data_to_postgres",
      "name": "Load AQI Data to PostgreSQL",
      "category": "Loader",
      "description": "Loads extracted AQI data into PostgreSQL data warehouse with dimensional modeling. Implements full ETL process with dimension and fact table population using ON CONFLICT DO NOTHING for dimension tables.",
      "inputs": [
        "data/tmp_mahidol.json",
        "/opt/airflow/config/mapping_main_pollution.json"
      ],
      "outputs": [
        "dimDateTimeTable",
        "dimLocationTable",
        "dimMainPollutionTable",
        "factmahidolaqitable"
      ],
      "executor_type": "python",
      "executor_config": {
        "image": null,
        "command": null,
        "script_path": null,
        "entry_point": null,
        "environment": {},
        "resources": {
          "cpu": null,
          "memory": null,
          "gpu": null
        },
        "network": null
      },
      "io_spec": [
        {
          "name": "json_input",
          "direction": "input",
          "kind": "file",
          "format": "json",
          "path_pattern": "data/tmp_mahidol.json",
          "connection_id": null
        },
        {
          "name": "config_input",
          "direction": "input",
          "kind": "file",
          "format": "json",
          "path_pattern": "/opt/airflow/config/mapping_main_pollution.json",
          "connection_id": null
        },
        {
          "name": "postgres_tables",
          "direction": "output",
          "kind": "table",
          "format": "sql",
          "path_pattern": "postgres://database/tables/*",
          "connection_id": "postgres_conn"
        }
      ],
      "upstream_policy": {
        "type": "all_success",
        "description": "Requires successful completion of parse_aqi_html_to_json",
        "timeout_seconds": null
      },
      "retry_policy": {
        "max_attempts": 3,
        "delay_seconds": 10,
        "exponential_backoff": true,
        "retry_on": [
          "database_error",
          "data_validation_error"
        ]
      },
      "concurrency": {
        "supports_parallelism": false,
        "supports_dynamic_mapping": false,
        "map_over_param": null,
        "max_parallel_instances": null
      },
      "connections": [
        {
          "id": "postgres_conn",
          "type": "database",
          "purpose": "Load data into PostgreSQL tables"
        }
      ],
      "datasets": {
        "consumes": [
          "mahidol_aqi_json"
        ],
        "produces": [
          "dimDateTimeTable",
          "dimLocationTable",
          "dimMainPollutionTable",
          "factmahidolaqitable"
        ]
      }
    },
    {
      "id": "send_aqi_alert_email",
      "name": "Send AQI Alert Email",
      "category": "Notifier",
      "description": "Sends email alerts to configured recipients when AQI values exceed safe thresholds. Conditional execution - skips if AQI is safe (0-50).",
      "inputs": [
        "data/tmp_mahidol.json",
        "config.conf",
        "pm25_alert_emails.txt"
      ],
      "outputs": [
        "Email notifications"
      ],
      "executor_type": "python",
      "executor_config": {
        "image": null,
        "command": null,
        "script_path": null,
        "entry_point": null,
        "environment": {},
        "resources": {
          "cpu": null,
          "memory": null,
          "gpu": null
        },
        "network": null
      },
      "io_spec": [
        {
          "name": "json_input",
          "direction": "input",
          "kind": "file",
          "format": "json",
          "path_pattern": "data/tmp_mahidol.json",
          "connection_id": null
        },
        {
          "name": "config_file",
          "direction": "input",
          "kind": "file",
          "format": "other",
          "path_pattern": "config.conf",
          "connection_id": null
        },
        {
          "name": "recipient_list",
          "direction": "input",
          "kind": "file",
          "format": "txt",
          "path_pattern": "pm25_alert_emails.txt",
          "connection_id": null
        },
        {
          "name": "email_notifications",
          "direction": "output",
          "kind": "api",
          "format": "other",
          "path_pattern": "smtp://smtp.gmail.com:587",
          "connection_id": null
        }
      ],
      "upstream_policy": {
        "type": "all_success",
        "description": "Requires successful completion of load_aqi_data_to_postgres",
        "timeout_seconds": null
      },
      "retry_policy": {
        "max_attempts": 2,
        "delay_seconds": 30,
        "exponential_backoff": false,
        "retry_on": [
          "smtp_error",
          "network_error"
        ]
      },
      "concurrency": {
        "supports_parallelism": false,
        "supports_dynamic_mapping": false,
        "map_over_param": null,
        "max_parallel_instances": null
      },
      "connections": [
        {
          "id": "smtp_conn",
          "type": "api",
          "purpose": "Send email notifications via SMTP"
        }
      ],
      "datasets": {
        "consumes": [
          "mahidol_aqi_json"
        ],
        "produces": [
          "email_notifications"
        ]
      }
    }
  ],
  "flow_structure": {
    "pattern": "sequential",
    "entry_points": [
      "extract_mahidol_aqi_html"
    ],
    "nodes": {
      "extract_mahidol_aqi_html": {
        "kind": "Task",
        "component_type_id": "extract_mahidol_aqi_html",
        "upstream_policy": {
          "type": "all_success",
          "timeout_seconds": null
        },
        "next_nodes": [
          "parse_aqi_html_to_json"
        ],
        "branch_config": null,
        "sensor_config": null,
        "parallel_config": null
      },
      "parse_aqi_html_to_json": {
        "kind": "Task",
        "component_type_id": "parse_aqi_html_to_json",
        "upstream_policy": {
          "type": "all_success",
          "timeout_seconds": null
        },
        "next_nodes": [
          "load_aqi_data_to_postgres"
        ],
        "branch_config": null,
        "sensor_config": null,
        "parallel_config": null
      },
      "load_aqi_data_to_postgres": {
        "kind": "Task",
        "component_type_id": "load_aqi_data_to_postgres",
        "upstream_policy": {
          "type": "all_success",
          "timeout_seconds": null
        },
        "next_nodes": [
          "send_aqi_alert_email"
        ],
        "branch_config": null,
        "sensor_config": null,
        "parallel_config": null
      },
      "send_aqi_alert_email": {
        "kind": "Task",
        "component_type_id": "send_aqi_alert_email",
        "upstream_policy": {
          "type": "all_success",
          "timeout_seconds": null
        },
        "next_nodes": [],
        "branch_config": null,
        "sensor_config": null,
        "parallel_config": null
      }
    },
    "edges": [
      {
        "from": "extract_mahidol_aqi_html",
        "to": "parse_aqi_html_to_json",
        "edge_type": "success"
      },
      {
        "from": "parse_aqi_html_to_json",
        "to": "load_aqi_data_to_postgres",
        "edge_type": "success"
      },
      {
        "from": "load_aqi_data_to_postgres",
        "to": "send_aqi_alert_email",
        "edge_type": "success"
      }
    ]
  },
  "parameters": {
    "pipeline": {
      "name": {
        "description": "Pipeline identifier",
        "type": "string",
        "default": "PM2.5_Risk_Alert_Pipeline",
        "required": false,
        "constraints": null
      },
      "description": {
        "description": "Pipeline description",
        "type": "string",
        "default": "Comprehensive ETL pipeline that scrapes Mahidol University AQI data, processes HTML to extract air quality metrics, loads data into PostgreSQL, and sends email alerts when PM2.5 levels exceed safe thresholds",
        "required": false,
        "constraints": null
      },
      "tags": {
        "description": "Classification tags",
        "type": "array",
        "default": [
          "ETL",
          "air-quality",
          "scraping",
          "postgres",
          "email-alerts"
        ],
        "required": false
      }
    },
    "schedule": {
      "enabled": {
        "description": "Whether pipeline runs on schedule",
        "type": "boolean",
        "default": null,
        "required": false
      },
      "cron_expression": {
        "description": "Cron or preset (e.g., @daily, 0 0 * * *)",
        "type": "string",
        "default": null,
        "required": false
      },
      "start_date": {
        "description": "When to start scheduling",
        "type": "datetime",
        "default": null,
        "required": false,
        "format": "ISO8601"
      },
      "end_date": {
        "description": "When to stop scheduling",
        "type": "datetime",
        "default": null,
        "required": false
      },
      "timezone": {
        "description": "Schedule timezone",
        "type": "string",
        "default": null,
        "required": false
      },
      "catchup": {
        "description": "Run missed intervals",
        "type": "boolean",
        "default": null,
        "required": false
      },
      "batch_window": {
        "description": "Batch window parameter name (e.g., ds, execution_date)",
        "type": "string",
        "default": null,
        "required": false
      },
      "partitioning": {
        "description": "Data partitioning strategy (e.g., daily, hourly, monthly)",
        "type": "string",
        "default": "daily",
        "required": false
      }
    },
    "execution": {
      "max_active_runs": {
        "description": "Max concurrent pipeline runs",
        "type": "integer",
        "default": null,
        "required": false
      },
      "timeout_seconds": {
        "description": "Pipeline execution timeout",
        "type": "integer",
        "default": null,
        "required": false
      },
      "retry_policy": {
        "description": "Pipeline-level retry behavior",
        "type": "object",
        "default": null,
        "required": false
      },
      "depends_on_past": {
        "description": "Whether execution depends on previous run success",
        "type": "boolean",
        "default": true,
        "required": false
      }
    },
    "components": {
      "extract_mahidol_aqi_html": {
        "http_timeout": {
          "description": "Timeout for HTTP request to Mahidol website",
          "type": "integer",
          "default": 10,
          "required": false,
          "constraints": "Must be positive integer"
        },
        "output_file_path": {
          "description": "Path to save HTML file",
          "type": "string",
          "default": "data/mahidol_aqi.html",
          "required": false,
          "constraints": "Must be valid file path"
        },
        "source_url": {
          "description": "URL to scrape AQI data from",
          "type": "string",
          "default": "https://mahidol.ac.th/aqireport/",
          "required": false,
          "constraints": "Must be valid URL"
        }
      },
      "parse_aqi_html_to_json": {
        "input_html_path": {
          "description": "Path to input HTML file",
          "type": "string",
          "default": "data/mahidol_aqi.html",
          "required": false,
          "constraints": "Must be valid file path"
        },
        "output_json_path": {
          "description": "Path to output JSON file",
          "type": "string",
          "default": "data/tmp_mahidol.json",
          "required": false,
          "constraints": "Must be valid file path"
        },
        "datetime_format": {
          "description": "Format for datetime conversion",
          "type": "string",
          "default": "%Y-%m-%d %H:%M:%S",
          "required": false,
          "constraints": "Must be valid Python datetime format string"
        }
      },
      "load_aqi_data_to_postgres": {
        "input_json_path": {
          "description": "Path to input JSON file",
          "type": "string",
          "default": "data/tmp_mahidol.json",
          "required": false,
          "constraints": "Must be valid file path"
        },
        "config_file_path": {
          "description": "Path to pollution mapping config file",
          "type": "string",
          "default": "/opt/airflow/config/mapping_main_pollution.json",
          "required": false,
          "constraints": "Must be valid file path"
        },
        "db_connection_id": {
          "description": "PostgreSQL connection identifier",
          "type": "string",
          "default": "postgres_conn",
          "required": false,
          "constraints": "Must match existing connection ID"
        }
      },
      "send_aqi_alert_email": {
        "recipient_list_file": {
          "description": "Path to file containing email recipients",
          "type": "string",
          "default": "pm25_alert_emails.txt",
          "required": false,
          "constraints": "Must be valid file path"
        },
        "config_file_path": {
          "description": "Path to email configuration file",
          "type": "string",
          "default": "config.conf",
          "required": false,
          "constraints": "Must be valid file path"
        },
        "smtp_server": {
          "description": "SMTP server address",
          "type": "string",
          "default": "smtp.gmail.com:587",
          "required": false,
          "constraints": "Must be valid SMTP server address with port"
        },
        "aqi_thresholds": {
          "description": "AQI threshold levels for alert categorization",
          "type": "object",
          "default": {
            "safe": "0-50",
            "moderate": "51-100",
            "unhealthy": "101-200",
            "hazardous": ">200"
          },
          "required": false,
          "constraints": "Must define threshold ranges for alert levels"
        }
      }
    },
    "environment": {
      "BASE_DIR": {
        "description": "Base directory for data and config files",
        "type": "string",
        "default": null,
        "required": false,
        "associated_component_id": null
      },
      "POSTGRES_CONN": {
        "description": "PostgreSQL connection identifier",
        "type": "string",
        "default": "postgres_conn",
        "required": false,
        "associated_component_id": "load_aqi_data_to_postgres"
      }
    }
  },
  "integrations": {
    "connections": [
      {
        "id": "mahidol_aqi_website",
        "name": "Mahidol University AQI Website",
        "type": "api",
        "config": {
          "base_url": "https://mahidol.ac.th/aqireport/",
          "host": null,
          "port": null,
          "protocol": "https",
          "database": null,
          "schema": null,
          "bucket": null,
          "queue_name": null,
          "base_path": null
        },
        "authentication": {
          "type": "none",
          "token_env_var": null,
          "username_env_var": null,
          "password_env_var": null,
          "credentials_path": null
        },
        "used_by_components": [
          "extract_mahidol_aqi_html"
        ],
        "direction": "input",
        "rate_limit": {
          "requests_per_second": null,
          "burst": null
        },
        "datasets": {
          "produces": [],
          "consumes": [
            "mahidol_aqi_html"
          ]
        }
      },
      {
        "id": "local_filesystem_data",
        "name": "Local Filesystem Data Storage",
        "type": "filesystem",
        "config": {
          "base_path": "data",
          "base_url": null,
          "host": null,
          "port": null,
          "protocol": "file",
          "database": null,
          "schema": null,
          "bucket": null,
          "queue_name": null
        },
        "authentication": {
          "type": "none",
          "token_env_var": null,
          "username_env_var": null,
          "password_env_var": null,
          "credentials_path": null
        },
        "used_by_components": [
          "extract_mahidol_aqi_html",
          "parse_aqi_html_to_json",
          "load_aqi_data_to_postgres",
          "send_aqi_alert_email"
        ],
        "direction": "both",
        "rate_limit": {
          "requests_per_second": null,
          "burst": null
        },
        "datasets": {
          "produces": [
            "mahidol_aqi_html",
            "tmp_mahidol_json"
          ],
          "consumes": [
            "mahidol_aqi_html",
            "tmp_mahidol_json",
            "existing_json_for_comparison"
          ]
        }
      },
      {
        "id": "postgres_data_warehouse",
        "name": "PostgreSQL Data Warehouse",
        "type": "database",
        "config": {
          "base_path": null,
          "base_url": null,
          "host": null,
          "port": null,
          "protocol": "jdbc",
          "database": null,
          "schema": null,
          "bucket": null,
          "queue_name": null
        },
        "authentication": {
          "type": "other",
          "token_env_var": null,
          "username_env_var": null,
          "password_env_var": null,
          "credentials_path": null
        },
        "used_by_components": [
          "parse_aqi_html_to_json",
          "load_aqi_data_to_postgres"
        ],
        "direction": "both",
        "rate_limit": {
          "requests_per_second": null,
          "burst": null
        },
        "datasets": {
          "produces": [
            "factmahidolaqitable",
            "dimDateTimeTable",
            "dimLocationTable",
            "dimMainPollutionTable"
          ],
          "consumes": [
            "factmahidolaqitable"
          ]
        }
      },
      {
        "id": "gmail_smtp_server",
        "name": "Gmail SMTP Server",
        "type": "api",
        "config": {
          "base_url": null,
          "host": "smtp.gmail.com",
          "port": 587,
          "protocol": "smtp",
          "database": null,
          "schema": null,
          "bucket": null,
          "queue_name": null,
          "base_path": null
        },
        "authentication": {
          "type": "basic",
          "token_env_var": null,
          "username_env_var": "EMAIL_USERNAME",
          "password_env_var": "EMAIL_PASSWORD",
          "credentials_path": null
        },
        "used_by_components": [
          "send_aqi_alert_email"
        ],
        "direction": "output",
        "rate_limit": {
          "requests_per_second": null,
          "burst": null
        },
        "datasets": {
          "produces": [
            "email_notifications"
          ],
          "consumes": []
        }
      },
      {
        "id": "local_config_files",
        "name": "Local Configuration Files",
        "type": "filesystem",
        "config": {
          "base_path": "/opt/airflow/config",
          "base_url": null,
          "host": null,
          "port": null,
          "protocol": "file",
          "database": null,
          "schema": null,
          "bucket": null,
          "queue_name": null
        },
        "authentication": {
          "type": "none",
          "token_env_var": null,
          "username_env_var": null,
          "password_env_var": null,
          "credentials_path": null
        },
        "used_by_components": [
          "load_aqi_data_to_postgres",
          "send_aqi_alert_email"
        ],
        "direction": "input",
        "rate_limit": {
          "requests_per_second": null,
          "burst": null
        },
        "datasets": {
          "produces": [],
          "consumes": [
            "mapping_main_pollution_json",
            "config_conf",
            "pm25_alert_emails_txt"
          ]
        }
      }
    ],
    "data_lineage": {
      "sources": [
        "Mahidol University AQI website (https://mahidol.ac.th/aqireport/)",
        "Existing JSON file for data freshness comparison",
        "PostgreSQL factmahidolaqitable for duplicate detection"
      ],
      "sinks": [
        "PostgreSQL data warehouse tables (dimDateTimeTable, dimLocationTable, dimMainPollutionTable, factmahidolaqitable)",
        "Email notifications sent via Gmail SMTP server"
      ],
      "intermediate_datasets": [
        "data/mahidol_aqi.html",
        "data/tmp_mahidol.json",
        "/opt/airflow/config/mapping_main_pollution.json",
        "config.conf",
        "pm25_alert_emails.txt"
      ]
    }
  }
}