# Generated by Dagster Code Generator
# Generation Date: 2023-10-05
# Dagster Version: 1.5.0

from dagster import (
    job,
    op,
    In,
    Out,
    RetryPolicy,
    resource,
    Field,
    String,
    fs_io_manager,
    in_process_executor,
)

# Resources
@resource(config_schema={"url": Field(String, is_required=True)})
def github_releases(context):
    """Resource for accessing GitHub Mondo Releases."""
    return context.resource_config["url"]

@resource(config_schema={"bucket": Field(String, is_required=True)})
def s3_datalake(context):
    """Resource for accessing S3 Datalake."""
    return context.resource_config["bucket"]

@resource(config_schema={"url": Field(String, is_required=True)})
def elasticsearch(context):
    """Resource for accessing Elasticsearch."""
    return context.resource_config["url"]

@resource(config_schema={"webhook_url": Field(String, is_required=True)})
def slack_webhook(context):
    """Resource for sending notifications to Slack."""
    return context.resource_config["webhook_url"]

# Ops
@op(
    required_resource_keys={"github_releases"},
    out={"validated_params": Out(dict)},
)
def params_validate(context):
    """Validate input parameters."""
    # Example validation logic
    validated_params = {"param1": "value1", "param2": "value2"}
    context.log.info("Parameters validated successfully.")
    return validated_params

@op(
    required_resource_keys={"github_releases"},
    ins={"validated_params": In(dict)},
    out={"mondo_terms": Out(list)},
)
def download_mondo_terms(context, validated_params):
    """Download Mondo terms from GitHub."""
    # Example download logic
    mondo_terms = ["term1", "term2", "term3"]
    context.log.info("Mondo terms downloaded successfully.")
    return mondo_terms

@op(
    ins={"mondo_terms": In(list)},
    out={"normalized_terms": Out(list)},
)
def normalized_mondo_terms(context, mondo_terms):
    """Normalize Mondo terms."""
    # Example normalization logic
    normalized_terms = [term.lower() for term in mondo_terms]
    context.log.info("Mondo terms normalized successfully.")
    return normalized_terms

@op(
    required_resource_keys={"elasticsearch"},
    ins={"normalized_terms": In(list)},
    out={"indexed_terms": Out(list)},
)
def index_mondo_terms(context, normalized_terms):
    """Index Mondo terms in Elasticsearch."""
    # Example indexing logic
    indexed_terms = normalized_terms
    context.log.info("Mondo terms indexed successfully.")
    return indexed_terms

@op(
    required_resource_keys={"s3_datalake"},
    ins={"indexed_terms": In(list)},
    out={"published_data": Out(dict)},
)
def publish_mondo(context, indexed_terms):
    """Publish Mondo data to S3."""
    # Example publishing logic
    published_data = {"bucket": "my-bucket", "key": "mondo-terms.json"}
    context.log.info("Mondo data published successfully.")
    return published_data

@op(
    required_resource_keys={"slack_webhook"},
    ins={"published_data": In(dict)},
)
def slack(context, published_data):
    """Send Slack notification."""
    # Example notification logic
    message = f"Mondo data published to S3: {published_data['bucket']}/{published_data['key']}"
    context.log.info(f"Slack notification sent: {message}")

# Job
@job(
    name="params_validate_pipeline",
    description="No description provided.",
    executor_def=in_process_executor,
    resource_defs={
        "github_releases": github_releases,
        "s3_datalake": s3_datalake,
        "elasticsearch": elasticsearch,
        "slack_webhook": slack_webhook,
        "io_manager": fs_io_manager,
    },
)
def params_validate_pipeline():
    """Dagster job for validating parameters, downloading, normalizing, indexing, and publishing Mondo terms."""
    validated_params = params_validate()
    mondo_terms = download_mondo_terms(validated_params)
    normalized_terms = normalized_mondo_terms(mondo_terms)
    indexed_terms = index_mondo_terms(normalized_terms)
    published_data = publish_mondo(indexed_terms)
    slack(published_data)