# Generated by Dagster Code Generator
# Generation Metadata:
# - Job Name: run_ctas_pipeline
# - Description: No description provided.
# - Executor Type: in_process_executor
# - IO Manager: fs_io_manager
# - Dagster Version: 1.5.0
# - Use Assets: False
# - Required Resources: [snowflake_conn]

from dagster import job, op, Out, In, RetryPolicy, ResourceDefinition, fs_io_manager, in_process_executor, schedule

# Define the Snowflake connection resource
snowflake_conn = ResourceDefinition.hardcoded_resource("snowflake_connection")

# Define the Slack connection resource
slack_conn = ResourceDefinition.hardcoded_resource("slack_connection")

@op(
    name="run_ctas",
    description="Run CTAS",
    out=Out(str, description="Output of the CTAS operation"),
    required_resource_keys={"snowflake_conn"},
    retry_policy=RetryPolicy(max_retries=3)
)
def run_ctas(context):
    """
    Run a CTAS (Create Table As Select) operation in Snowflake.

    Args:
        context (OpExecutionContext): The execution context for the op.

    Returns:
        str: The output of the CTAS operation.
    """
    # Example of running a CTAS operation
    snowflake_conn = context.resources.snowflake_conn
    query = "CREATE TABLE new_table AS SELECT * FROM existing_table;"
    result = snowflake_conn.execute(query)
    return result

@job(
    name="run_ctas_pipeline",
    description="No description provided.",
    executor_def=in_process_executor,
    resource_defs={"snowflake_conn": snowflake_conn, "slack_conn": slack_conn},
    io_manager_def=fs_io_manager
)
def run_ctas_pipeline():
    """
    Dagster job to run the CTAS pipeline.

    This job runs the `run_ctas` op.
    """
    run_ctas()

@schedule(
    job=run_ctas_pipeline,
    cron_schedule="@daily",
    execution_timezone="UTC",
    name="run_ctas_pipeline_schedule",
    catchup=False
)
def run_ctas_pipeline_schedule(_context):
    """
    Schedule to run the `run_ctas_pipeline` job daily.
    """
    return {}