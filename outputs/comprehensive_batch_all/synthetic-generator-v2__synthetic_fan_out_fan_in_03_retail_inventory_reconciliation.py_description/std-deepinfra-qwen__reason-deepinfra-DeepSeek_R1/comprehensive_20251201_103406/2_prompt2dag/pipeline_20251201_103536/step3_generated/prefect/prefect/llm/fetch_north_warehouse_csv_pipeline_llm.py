# Generated by Prefect 2.x Code Generator
# Date: 2023-10-05
# Prefect Version: 2.14.0

from prefect import flow, task, get_run_logger
from prefect.deployments import Deployment
from prefect.orion.schemas.schedules import CronSchedule
from prefect.task_runners import ConcurrentTaskRunner
from prefect.blocks.system import Secret

# Load secrets
north_warehouse_api = Secret.load("north-warehouse-api")
south_warehouse_api = Secret.load("south-warehouse-api")
east_warehouse_api = Secret.load("east-warehouse-api")
west_warehouse_api = Secret.load("west-warehouse-api")
xcom_storage = Secret.load("xcom-storage")

@task(retries=2, name="Fetch East Warehouse CSV")
def fetch_east_warehouse_csv():
    logger = get_run_logger()
    logger.info("Fetching CSV from East Warehouse")
    # Placeholder for actual CSV fetching logic
    return "east_warehouse.csv"

@task(retries=2, name="Fetch North Warehouse CSV")
def fetch_north_warehouse_csv():
    logger = get_run_logger()
    logger.info("Fetching CSV from North Warehouse")
    # Placeholder for actual CSV fetching logic
    return "north_warehouse.csv"

@task(retries=2, name="Fetch South Warehouse CSV")
def fetch_south_warehouse_csv():
    logger = get_run_logger()
    logger.info("Fetching CSV from South Warehouse")
    # Placeholder for actual CSV fetching logic
    return "south_warehouse.csv"

@task(retries=2, name="Fetch West Warehouse CSV")
def fetch_west_warehouse_csv():
    logger = get_run_logger()
    logger.info("Fetching CSV from West Warehouse")
    # Placeholder for actual CSV fetching logic
    return "west_warehouse.csv"

@task(retries=2, name="Normalize East SKUs")
def normalize_east_skus(csv_file):
    logger = get_run_logger()
    logger.info(f"Normalizing SKUs from {csv_file}")
    # Placeholder for actual normalization logic
    return "normalized_east_skus.csv"

@task(retries=2, name="Normalize North SKUs")
def normalize_north_skus(csv_file):
    logger = get_run_logger()
    logger.info(f"Normalizing SKUs from {csv_file}")
    # Placeholder for actual normalization logic
    return "normalized_north_skus.csv"

@task(retries=2, name="Normalize South SKUs")
def normalize_south_skus(csv_file):
    logger = get_run_logger()
    logger.info(f"Normalizing SKUs from {csv_file}")
    # Placeholder for actual normalization logic
    return "normalized_south_skus.csv"

@task(retries=2, name="Normalize West SKUs")
def normalize_west_skus(csv_file):
    logger = get_run_logger()
    logger.info(f"Normalizing SKUs from {csv_file}")
    # Placeholder for actual normalization logic
    return "normalized_west_skus.csv"

@task(retries=2, name="Reconcile All Inventories")
def reconcile_all_inventories(north_skus, south_skus, east_skus, west_skus):
    logger = get_run_logger()
    logger.info("Reconciling all inventories")
    # Placeholder for actual reconciliation logic
    return "reconciled_inventories.csv"

@task(retries=2, name="Generate Final Report")
def generate_final_report(reconciled_inventories):
    logger = get_run_logger()
    logger.info(f"Generating final report from {reconciled_inventories}")
    # Placeholder for actual report generation logic
    return "final_report.csv"

@flow(name="fetch_north_warehouse_csv_pipeline", task_runner=ConcurrentTaskRunner())
def fetch_north_warehouse_csv_pipeline():
    logger = get_run_logger()
    logger.info("Starting fetch_north_warehouse_csv_pipeline")

    north_csv = fetch_north_warehouse_csv()
    south_csv = fetch_south_warehouse_csv()
    east_csv = fetch_east_warehouse_csv()
    west_csv = fetch_west_warehouse_csv()

    north_skus = normalize_north_skus(north_csv)
    south_skus = normalize_south_skus(south_csv)
    east_skus = normalize_east_skus(east_csv)
    west_skus = normalize_west_skus(west_csv)

    reconciled_inventories = reconcile_all_inventories(north_skus, south_skus, east_skus, west_skus)
    final_report = generate_final_report(reconciled_inventories)

    logger.info("Pipeline completed successfully")

# Schedule the flow
deployment = Deployment.build_from_flow(
    flow=fetch_north_warehouse_csv_pipeline,
    name="fetch_north_warehouse_csv_pipeline_deployment",
    work_pool_name="default-agent-pool",
    schedule=CronSchedule(cron="0 0 * * *", timezone="UTC", catchup=False),
)

if __name__ == "__main__":
    deployment.apply()