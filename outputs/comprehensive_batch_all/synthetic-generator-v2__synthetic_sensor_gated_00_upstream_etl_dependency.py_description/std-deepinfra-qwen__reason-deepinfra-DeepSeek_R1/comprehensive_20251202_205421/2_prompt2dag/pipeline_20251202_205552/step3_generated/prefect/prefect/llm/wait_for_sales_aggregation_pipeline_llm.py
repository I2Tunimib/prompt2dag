# Generated by Prefect 2.x Code Generator
# Date: [Current Date]
# Prefect Version: 2.14.0

from prefect import flow, task, get_run_logger
from prefect.task_runners import SequentialTaskRunner
from prefect.blocks.system import Secret
from prefect.filesystems import LocalFileSystem
from prefect.deployments import Deployment
from prefect.orion.schemas.schedules import CronSchedule
import subprocess

# Load secrets and resources
daily_sales_aggregation_dag = Secret.load("daily_sales_aggregation_dag")
sales_csv_data = LocalFileSystem.load("sales_csv_data")

@task(retries=0, name="Wait for Sales Aggregation")
def wait_for_sales_aggregation():
    """
    Task to wait for the daily sales aggregation DAG to complete.
    """
    logger = get_run_logger()
    logger.info("Waiting for the daily sales aggregation DAG to complete.")
    # Example command to wait for the DAG (replace with actual command)
    subprocess.run(["airflow", "dags", "trigger", daily_sales_aggregation_dag.get()])

@task(retries=2, name="Load Sales CSV")
def load_sales_csv():
    """
    Task to load the sales CSV data.
    """
    logger = get_run_logger()
    logger.info("Loading sales CSV data.")
    # Example command to load CSV data (replace with actual command)
    subprocess.run(["cat", sales_csv_data.basepath + "/sales.csv"])

@task(retries=2, name="Generate Dashboard")
def generate_dashboard():
    """
    Task to generate the dashboard.
    """
    logger = get_run_logger()
    logger.info("Generating dashboard.")
    # Example command to generate dashboard (replace with actual command)
    subprocess.run(["python", "generate_dashboard.py"])

@flow(name="wait_for_sales_aggregation_pipeline", task_runner=SequentialTaskRunner)
def wait_for_sales_aggregation_pipeline():
    """
    Main flow to orchestrate the sales aggregation pipeline.
    """
    wait_for_sales_aggregation()
    load_sales_csv()
    generate_dashboard()

# Deployment configuration
deployment = Deployment.build_from_flow(
    flow=wait_for_sales_aggregation_pipeline,
    name="wait_for_sales_aggregation_pipeline_deployment",
    work_pool_name="default-agent-pool",
    schedule=CronSchedule(cron="0 0 * * *", timezone="UTC", day_or=True),
    parameters={},
    tags=[],
    description="No description provided.",
)

if __name__ == "__main__":
    deployment.apply()