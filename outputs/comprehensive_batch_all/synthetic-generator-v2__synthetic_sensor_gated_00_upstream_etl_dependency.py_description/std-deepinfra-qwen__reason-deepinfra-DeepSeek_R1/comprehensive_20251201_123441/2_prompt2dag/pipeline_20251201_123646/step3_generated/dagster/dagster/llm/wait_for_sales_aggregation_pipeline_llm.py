# Generated by Dagster Code Generator
# Generation Metadata:
# - Job Name: wait_for_sales_aggregation_pipeline
# - Description: No description provided.
# - Executor Type: in_process_executor
# - IO Manager: fs_io_manager
# - Dagster Version: 1.5.0
# - Use Assets: False
# - Required Resources: ["daily_sales_aggregation"]

from dagster import job, op, In, Out, RetryPolicy, resource, fs_io_manager, daily_schedule

@resource
def daily_sales_aggregation_dag(context):
    """Resource for the Daily Sales Aggregation DAG."""
    return context.resources.daily_sales_aggregation

@op(
    name="wait_for_sales_aggregation",
    description="Wait for Sales Aggregation",
    required_resource_keys={"daily_sales_aggregation"},
    retry_policy=RetryPolicy(max_retries=0),
)
def wait_for_sales_aggregation(context):
    """Wait for the daily sales aggregation to complete."""
    context.log.info("Waiting for sales aggregation to complete.")
    # Simulate waiting for the aggregation to complete
    context.resources.daily_sales_aggregation.wait_for_completion()
    context.log.info("Sales aggregation completed.")

@op(
    name="load_sales_csv",
    description="Load Sales CSV",
    ins={"aggregation_complete": In()},
    out=Out(io_manager_key="sales_csv_data"),
    retry_policy=RetryPolicy(max_retries=2),
)
def load_sales_csv(context, aggregation_complete):
    """Load the sales CSV data after the aggregation is complete."""
    context.log.info("Loading sales CSV data.")
    # Simulate loading the CSV data
    sales_data = context.resources.sales_csv_data.load_data()
    context.log.info(f"Loaded sales data: {sales_data}")
    return sales_data

@op(
    name="generate_dashboard",
    description="Generate Dashboard",
    ins={"sales_data": In()},
    retry_policy=RetryPolicy(max_retries=2),
)
def generate_dashboard(context, sales_data):
    """Generate the dashboard using the loaded sales data."""
    context.log.info("Generating dashboard.")
    # Simulate generating the dashboard
    dashboard = context.resources.sales_csv_data.generate_dashboard(sales_data)
    context.log.info(f"Generated dashboard: {dashboard}")
    return dashboard

@job(
    name="wait_for_sales_aggregation_pipeline",
    description="No description provided.",
    executor_def=in_process_executor,
    resource_defs={
        "daily_sales_aggregation": daily_sales_aggregation_dag,
        "sales_csv_data": fs_io_manager,
    },
)
def wait_for_sales_aggregation_pipeline():
    """Dagster job to wait for sales aggregation, load sales CSV, and generate a dashboard."""
    aggregation_complete = wait_for_sales_aggregation()
    sales_data = load_sales_csv(aggregation_complete)
    generate_dashboard(sales_data)

@daily_schedule(
    pipeline_name="wait_for_sales_aggregation_pipeline",
    start_date="2023-01-01",
    execution_time="00:00",
    execution_timezone="UTC",
    name="wait_for_sales_aggregation_pipeline_schedule",
    description="Daily schedule for the wait_for_sales_aggregation_pipeline.",
    schedule_name="wait_for_sales_aggregation_pipeline_schedule",
    execution_timezone="UTC",
    should_execute=lambda _context: True,
    environment_vars={},
)
def wait_for_sales_aggregation_pipeline_schedule(date):
    return {
        "resources": {
            "daily_sales_aggregation": {"config": {"date": date.strftime("%Y-%m-%d")}},
        },
    }