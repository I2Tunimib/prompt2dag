# Generated by Prefect 2.x Code Generator
# Date: 2023-10-05
# Prefect Version: 2.14.0

from prefect import flow, task, get_run_logger
from prefect.task_runners import SequentialTaskRunner
from prefect.deployments import Deployment
from prefect.orion.schemas.schedules import CronSchedule
from prefect.infrastructure import Process
from prefect.filesystems import LocalFileSystem
from prefect.blocks.secrets import Secret

# Define the local file system block
local_shell = LocalFileSystem(basepath="/path/to/local/shell")

# Define the secret block for the Hive local database
hive_local = Secret.load("hive_local")

@task(retries=0, name="Run After Loop")
def run_after_loop():
    """
    Task to run a process after a loop.
    """
    logger = get_run_logger()
    logger.info("Running after loop task")
    # Example command: echo "Running after loop"
    process = Process(command=["echo", "Running after loop"], stream_output=True)
    process.run()

@task(retries=0, name="Hive Script Task")
def hive_script_task():
    """
    Task to run a Hive script.
    """
    logger = get_run_logger()
    logger.info("Running Hive script task")
    # Example command: hive -f /path/to/hive/script.hql
    process = Process(command=["hive", "-f", "/path/to/hive/script.hql"], stream_output=True)
    process.run()

@flow(name="run_after_loop_pipeline", task_runner=SequentialTaskRunner)
def run_after_loop_pipeline():
    """
    Main flow to orchestrate the tasks.
    """
    logger = get_run_logger()
    logger.info("Starting run_after_loop_pipeline")

    # Run the tasks in sequence
    run_after_loop_result = run_after_loop()
    hive_script_task_result = hive_script_task(wait_for=[run_after_loop_result])

    logger.info("run_after_loop_pipeline completed")

# Define the deployment
deployment = Deployment.build_from_flow(
    flow=run_after_loop_pipeline,
    name="run_after_loop_pipeline_deployment",
    work_pool_name="default-agent-pool",
    schedule=CronSchedule(cron="00 1 * * *", timezone="UTC", catchup=False),
    parameters={},
    tags=[],
    infrastructure=Process(),
    work_queue_name="default",
    version="1.0.0",
)

if __name__ == "__main__":
    deployment.apply()