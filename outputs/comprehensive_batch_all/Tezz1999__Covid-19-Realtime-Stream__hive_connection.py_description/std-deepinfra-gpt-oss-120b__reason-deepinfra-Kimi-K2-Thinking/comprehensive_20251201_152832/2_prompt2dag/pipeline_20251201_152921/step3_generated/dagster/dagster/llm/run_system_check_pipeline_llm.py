# Generated by Dagster code generator
# Date: 2024-06-13
# Dagster version: 1.5.0

from dagster import (
    op,
    job,
    In,
    Out,
    RetryPolicy,
    ResourceDefinition,
    fs_io_manager,
    in_process_executor,
    ScheduleDefinition,
    DefaultScheduleStatus,
)


def _hive_local_resource(_):
    """
    Placeholder implementation for a Hive local connection resource.
    Replace this with actual connection logic as needed.
    """
    # Example: return a simple dict representing connection parameters
    return {
        "host": "localhost",
        "port": 10000,
        "database": "default",
        "auth_mechanism": "NONE",
    }


hive_local = ResourceDefinition.hardcoded_resource(_hive_local_resource)


@op(
    name="run_system_check",
    description="Performs a system health check.",
    out=Out(str),
    retry_policy=RetryPolicy(max_retries=0),
)
def run_system_check() -> str:
    """
    Execute any necessary system checks.
    Returns a simple status string that downstream ops can consume.
    """
    # Placeholder logic â€“ replace with real checks as required.
    status = "SYSTEM_OK"
    return status


@op(
    name="run_hive_script",
    description="Executes a Hive script using the Hive local connection.",
    ins={"system_status": In(str)},
    out=Out(str),
    required_resource_keys={"hive_local"},
    retry_policy=RetryPolicy(max_retries=0),
)
def run_hive_script(context, system_status: str) -> str:
    """
    Run a Hive script after confirming the system check passed.

    Args:
        context: Dagster context providing access to resources.
        system_status: Output from the ``run_system_check`` op.

    Returns:
        A string indicating the result of the Hive script execution.
    """
    if system_status != "SYSTEM_OK":
        raise RuntimeError("System check failed; aborting Hive script execution.")

    hive_conn = context.resources.hive_local
    # Placeholder for Hive script execution.
    # Replace the following with actual Hive query execution using ``hive_conn``.
    context.log.info(f"Connecting to Hive with params: {hive_conn}")
    result = "HIVE_SCRIPT_EXECUTED"
    return result


@job(
    name="run_system_check_pipeline",
    description="No description provided.",
    executor_def=in_process_executor,
    resource_defs={
        "hive_local": hive_local,
        "io_manager": fs_io_manager,
    },
)
def run_system_check_pipeline():
    """
    Dagster job that runs a system check followed by a Hive script execution.
    """
    system_status = run_system_check()
    run_hive_script(system_status)


run_system_check_schedule = ScheduleDefinition(
    job=run_system_check_pipeline,
    cron_schedule="00 1 * * *",
    execution_timezone="UTC",
    default_status=DefaultScheduleStatus.RUNNING,
    description="Scheduled execution of the run_system_check_pipeline at 01:00 UTC daily.",
    catchup=False,
)