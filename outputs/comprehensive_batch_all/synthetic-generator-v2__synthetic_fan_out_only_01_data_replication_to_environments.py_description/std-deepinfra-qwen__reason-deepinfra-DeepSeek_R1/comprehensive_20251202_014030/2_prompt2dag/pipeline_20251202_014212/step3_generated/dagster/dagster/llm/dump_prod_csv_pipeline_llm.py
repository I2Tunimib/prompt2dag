# Generated by Dagster Code Generator
# Generation Metadata:
# - Job Name: dump_prod_csv_pipeline
# - Description: No description provided.
# - Executor Type: multiprocess_executor
# - IO Manager: fs_io_manager
# - Dagster Version: 1.5.0
# - Use Assets: False
# - Required Resources: qa_db, dev_db, staging_db, local_filesystem

from dagster import (
    job,
    op,
    Out,
    In,
    RetryPolicy,
    multiprocess_executor,
    fs_io_manager,
    resource,
    ScheduleDefinition,
)

@resource
def prod_db():
    """Resource for connecting to the production database."""
    pass

@resource
def dev_db():
    """Resource for connecting to the development database."""
    pass

@resource
def staging_db():
    """Resource for connecting to the staging database."""
    pass

@resource
def qa_db():
    """Resource for connecting to the QA database."""
    pass

@op(
    out=Out(str, description="Path to the dumped CSV file"),
    retry_policy=RetryPolicy(max_retries=2),
    required_resource_keys={"prod_db", "local_filesystem"},
)
def dump_prod_csv(context):
    """Dump data from the production database to a CSV file."""
    # Example implementation (replace with actual logic)
    csv_path = "/path/to/dumped/prod.csv"
    context.log.info(f"Dumped production data to {csv_path}")
    return csv_path

@op(
    ins={"csv_path": In(str, description="Path to the CSV file")},
    retry_policy=RetryPolicy(max_retries=2),
    required_resource_keys={"dev_db"},
)
def copy_dev(context, csv_path):
    """Copy the CSV file to the development database."""
    # Example implementation (replace with actual logic)
    context.log.info(f"Copied {csv_path} to development database")

@op(
    ins={"csv_path": In(str, description="Path to the CSV file")},
    retry_policy=RetryPolicy(max_retries=2),
    required_resource_keys={"qa_db"},
)
def copy_qa(context, csv_path):
    """Copy the CSV file to the QA database."""
    # Example implementation (replace with actual logic)
    context.log.info(f"Copied {csv_path} to QA database")

@op(
    ins={"csv_path": In(str, description="Path to the CSV file")},
    retry_policy=RetryPolicy(max_retries=2),
    required_resource_keys={"staging_db"},
)
def copy_staging(context, csv_path):
    """Copy the CSV file to the staging database."""
    # Example implementation (replace with actual logic)
    context.log.info(f"Copied {csv_path} to staging database")

@job(
    name="dump_prod_csv_pipeline",
    description="No description provided.",
    executor_def=multiprocess_executor,
    resource_defs={
        "prod_db": prod_db,
        "dev_db": dev_db,
        "staging_db": staging_db,
        "qa_db": qa_db,
        "local_filesystem": fs_io_manager,
    },
)
def dump_prod_csv_pipeline():
    """Dagster job to dump production data to a CSV and copy it to multiple environments."""
    csv_path = dump_prod_csv()
    copy_dev(csv_path)
    copy_qa(csv_path)
    copy_staging(csv_path)

# Schedule the job to run daily
dump_prod_csv_pipeline_schedule = ScheduleDefinition(
    job=dump_prod_csv_pipeline,
    cron_schedule="@daily",
    execution_timezone="UTC",
    name="dump_prod_csv_pipeline_schedule",
    should_execute=lambda _context: True,
    tags=None,
    description="No description provided.",
    default_status="RUNNING",
)