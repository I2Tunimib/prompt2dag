# Generated by Dagster Code Generator
# Date: 2023-10-05
# Dagster Version: 1.5.0

from dagster import (
    job,
    op,
    In,
    Out,
    RetryPolicy,
    fs_io_manager,
    multiprocess_executor,
    resource,
    Field,
    String,
)

# Resources
@resource(config_schema={"url": Field(String, is_required=True)})
def data_gouv_fr_api(context):
    """Resource for data.gouv.fr API."""
    return context.resource_config["url"]

@resource(config_schema={"url": Field(String, is_required=True)})
def static_data_gouv_fr(context):
    """Resource for static.data.gouv.fr."""
    return context.resource_config["url"]

@resource(config_schema={"host": Field(String, is_required=True)})
def redis(context):
    """Resource for Redis."""
    return context.resource_config["host"]

@resource(config_schema={"host": Field(String, is_required=True)})
def postgresql(context):
    """Resource for PostgreSQL."""
    return context.resource_config["host"]

@resource(config_schema={"base_dir": Field(String, is_required=True)})
def ingestion_directory(context):
    """Resource for Ingestion Directory."""
    return context.resource_config["base_dir"]

@resource(config_schema={"base_dir": Field(String, is_required=True)})
def staging_directory(context):
    """Resource for Staging Directory."""
    return context.resource_config["base_dir"]

@resource(config_schema={"base_dir": Field(String, is_required=True)})
def sql_tmp_directory(context):
    """Resource for SQL Temporary Directory."""
    return context.resource_config["base_dir"]

# Ops
@op(
    out={"power_plant_data": Out()},
    retry_policy=RetryPolicy(max_retries=1),
)
def cleanse_power_plant_data(context):
    """Cleanse Power Plant Data."""
    # Placeholder for actual data cleansing logic
    return {"power_plant_data": "cleaned_data"}

@op(
    ins={"power_plant_data": In()},
    out={"plant_insert_queries": Out()},
    retry_policy=RetryPolicy(max_retries=1),
)
def generate_plant_insert_queries(context, power_plant_data):
    """Generate Plant Insert Queries."""
    # Placeholder for actual query generation logic
    return {"plant_insert_queries": "insert_queries"}

@op(
    out={"death_records": Out()},
    retry_policy=RetryPolicy(max_retries=1),
)
def load_death_records_to_redis(context):
    """Load Death Records to Redis."""
    # Placeholder for actual data loading logic
    return {"death_records": "loaded_data"}

@op(
    ins={"death_records": In()},
    out={"cleaned_death_data": Out()},
    retry_policy=RetryPolicy(max_retries=1),
)
def cleanse_death_data(context, death_records):
    """Cleanse Death Data."""
    # Placeholder for actual data cleansing logic
    return {"cleaned_death_data": "cleaned_data"}

@op(
    ins={"cleaned_death_data": In()},
    out={"is_empty": Out()},
    retry_policy=RetryPolicy(max_retries=1),
)
def check_death_data_emptiness(context, cleaned_death_data):
    """Check Death Data Emptiness."""
    # Placeholder for actual data check logic
    return {"is_empty": False}

@op(
    ins={"is_empty": In()},
    out={"stored_deaths": Out()},
    retry_policy=RetryPolicy(max_retries=1),
)
def store_deaths_in_postgres(context, is_empty):
    """Store Deaths in PostgreSQL."""
    # Placeholder for actual data storage logic
    return {"stored_deaths": "stored_data"}

@op(
    out={"city_geo_data": Out()},
    retry_policy=RetryPolicy(max_retries=1),
)
def extract_city_geo_data(context):
    """Extract City Geo Data."""
    # Placeholder for actual data extraction logic
    return {"city_geo_data": "extracted_data"}

@op(
    out={"nuclear_plants": Out()},
    retry_policy=RetryPolicy(max_retries=1),
)
def extract_nuclear_plants(context):
    """Extract Nuclear Plants."""
    # Placeholder for actual data extraction logic
    return {"nuclear_plants": "extracted_data"}

@op(
    ins={"plant_insert_queries": In()},
    out={"stored_plants": Out()},
    retry_policy=RetryPolicy(max_retries=1),
)
def store_plants_in_postgres(context, plant_insert_queries):
    """Store Plants in PostgreSQL."""
    # Placeholder for actual data storage logic
    return {"stored_plants": "stored_data"}

@op(
    out={"cleaned_tmp_files": Out()},
    retry_policy=RetryPolicy(max_retries=1),
)
def clean_tmp_death_files(context):
    """Clean Temporary Death Files."""
    # Placeholder for actual file cleaning logic
    return {"cleaned_tmp_files": "cleaned_files"}

@op(
    out={"thermal_plants": Out()},
    retry_policy=RetryPolicy(max_retries=1),
)
def extract_thermal_plants(context):
    """Extract Thermal Plants."""
    # Placeholder for actual data extraction logic
    return {"thermal_plants": "extracted_data"}

@op(
    out={"power_plant_table": Out()},
    retry_policy=RetryPolicy(max_retries=1),
)
def create_power_plant_table(context):
    """Create Power Plant Table."""
    # Placeholder for actual table creation logic
    return {"power_plant_table": "created_table"}

@op(
    out={"death_table": Out()},
    retry_policy=RetryPolicy(max_retries=1),
)
def create_death_table(context):
    """Create Death Table."""
    # Placeholder for actual table creation logic
    return {"death_table": "created_table"}

@op(
    out={"death_records": Out()},
    retry_policy=RetryPolicy(max_retries=1),
)
def extract_death_records(context):
    """Extract Death Records."""
    # Placeholder for actual data extraction logic
    return {"death_records": "extracted_data"}

# Job
@job(
    name="extract_death_records_pipeline",
    description="No description provided.",
    executor_def=multiprocess_executor,
    resource_defs={
        "data_gouv_api": data_gouv_fr_api,
        "static_data_gouv_fr": static_data_gouv_fr,
        "redis": redis,
        "postgresql": postgresql,
        "ingestion_directory": ingestion_directory,
        "staging_directory": staging_directory,
        "sql_tmp_directory": sql_tmp_directory,
    },
    config={
        "resources": {
            "data_gouv_api": {"config": {"url": "https://data.gouv.fr/api"}},
            "static_data_gouv_fr": {"config": {"url": "https://static.data.gouv.fr"}},
            "redis": {"config": {"host": "localhost"}},
            "postgresql": {"config": {"host": "localhost"}},
            "ingestion_directory": {"config": {"base_dir": "/path/to/ingestion"}},
            "staging_directory": {"config": {"base_dir": "/path/to/staging"}},
            "sql_tmp_directory": {"config": {"base_dir": "/path/to/sql/tmp"}},
        },
    },
)
def extract_death_records_pipeline():
    """Dagster job for extracting and processing death records and power plant data."""
    ingestion_pipeline_start = extract_death_records()
    extract_nuclear_plants(ingestion_pipeline_start)
    extract_thermal_plants(ingestion_pipeline_start)
    extract_city_geo_data(ingestion_pipeline_start)
    create_death_table()
    create_power_plant_table()
    load_death_records_to_redis()
    cleanse_death_data(load_death_records_to_redis)
    check_death_data_emptiness(cleanse_death_data)
    store_deaths_in_postgres(check_death_data_emptiness)
    store_plants_in_postgres()
    clean_tmp_death_files(store_plants_in_postgres)