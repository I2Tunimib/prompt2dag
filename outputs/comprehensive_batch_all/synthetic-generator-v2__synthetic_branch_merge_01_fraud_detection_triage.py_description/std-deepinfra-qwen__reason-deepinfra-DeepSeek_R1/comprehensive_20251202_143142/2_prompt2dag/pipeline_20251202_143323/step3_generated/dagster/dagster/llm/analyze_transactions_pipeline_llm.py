# Generated by Dagster Code Generator
# Generation Metadata:
# - Job Name: analyze_transactions_pipeline
# - Description: No description provided.
# - Executor Type: multiprocess_executor
# - IO Manager: fs_io_manager
# - Dagster Version: 1.5.0
# - Use Assets: False
# - Required Resources: notification_system, payment_processing_system, manual_review_queue, file_system

from dagster import (
    job,
    op,
    Out,
    In,
    RetryPolicy,
    multiprocess_executor,
    fs_io_manager,
    resource,
    schedule,
)

# Resources
@resource
def manual_review_queue():
    """Manual Review Queue Resource"""
    pass

@resource
def payment_processing_system():
    """Payment Processing System Resource"""
    pass

@resource
def notification_system():
    """Notification System Resource"""
    pass

@resource
def file_system():
    """File System Resource"""
    pass

# Ops
@op(
    out={"transactions": Out()},
    retry_policy=RetryPolicy(max_retries=2),
    required_resource_keys={"file_system"},
)
def analyze_transactions(context):
    """Analyze Transactions"""
    # Simulate reading transaction CSV files
    transactions = context.resources.file_system.read_transactions()
    return transactions

@op(
    ins={"transactions": In()},
    out={"auto_approve_transactions": Out(), "manual_review_transactions": Out()},
    retry_policy=RetryPolicy(max_retries=2),
)
def route_transaction(context, transactions):
    """Route Transaction"""
    auto_approve_transactions = []
    manual_review_transactions = []
    for transaction in transactions:
        if transaction.is_auto_approvable():
            auto_approve_transactions.append(transaction)
        else:
            manual_review_transactions.append(transaction)
    return auto_approve_transactions, manual_review_transactions

@op(
    ins={"transactions": In()},
    retry_policy=RetryPolicy(max_retries=2),
    required_resource_keys={"payment_processing_system"},
)
def route_to_auto_approve(context, transactions):
    """Route to Auto Approve"""
    for transaction in transactions:
        context.resources.payment_processing_system.process_transaction(transaction)

@op(
    ins={"transactions": In()},
    retry_policy=RetryPolicy(max_retries=2),
    required_resource_keys={"manual_review_queue"},
)
def route_to_manual_review(context, transactions):
    """Route to Manual Review"""
    for transaction in transactions:
        context.resources.manual_review_queue.add_transaction(transaction)

@op(
    ins={"auto_approve_transactions": In(), "manual_review_transactions": In()},
    retry_policy=RetryPolicy(max_retries=2),
    required_resource_keys={"notification_system"},
)
def send_notification(context, auto_approve_transactions, manual_review_transactions):
    """Send Notification"""
    context.resources.notification_system.send_notification(
        auto_approve_transactions, manual_review_transactions
    )

# Job
@job(
    name="analyze_transactions_pipeline",
    description="No description provided.",
    executor_def=multiprocess_executor,
    resource_defs={
        "file_system": file_system,
        "manual_review_queue": manual_review_queue,
        "payment_processing_system": payment_processing_system,
        "notification_system": notification_system,
    },
    io_manager_def=fs_io_manager,
)
def analyze_transactions_pipeline():
    """Analyze Transactions Pipeline"""
    transactions = analyze_transactions()
    auto_approve_transactions, manual_review_transactions = route_transaction(transactions)
    route_to_auto_approve(auto_approve_transactions)
    route_to_manual_review(manual_review_transactions)
    send_notification(auto_approve_transactions, manual_review_transactions)

# Schedule
@schedule(
    job=analyze_transactions_pipeline,
    cron_schedule="@daily",
    execution_timezone="UTC",
    name="analyze_transactions_pipeline_schedule",
    catchup=False,
)
def analyze_transactions_pipeline_schedule(_context):
    return {}