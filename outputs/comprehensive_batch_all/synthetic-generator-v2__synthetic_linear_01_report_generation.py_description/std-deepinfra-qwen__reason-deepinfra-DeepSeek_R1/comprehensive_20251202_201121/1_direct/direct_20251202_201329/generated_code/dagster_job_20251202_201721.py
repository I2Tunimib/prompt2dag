from dagster import op, job, resource, RetryPolicy, Failure, daily_schedule, get_dagster_logger
import pandas as pd
import matplotlib.pyplot as plt
import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
from email.mime.application import MIMEApplication
import os
import psycopg2

logger = get_dagster_logger()

@resource(config_schema={"host": str, "port": int, "database": str, "user": str, "password": str})
def postgres_db_resource(context):
    return psycopg2.connect(
        host=context.resource_config["host"],
        port=context.resource_config["port"],
        database=context.resource_config["database"],
        user=context.resource_config["user"],
        password=context.resource_config["password"]
    )

@resource(config_schema={"smtp_server": str, "smtp_port": int, "email": str, "password": str})
def smtp_resource(context):
    return {
        "smtp_server": context.resource_config["smtp_server"],
        "smtp_port": context.resource_config["smtp_port"],
        "email": context.resource_config["email"],
        "password": context.resource_config["password"]
    }

@op(required_resource_keys={"postgres_db"})
def query_sales_data(context):
    conn = context.resources.postgres_db
    cursor = conn.cursor()
    query = """
    SELECT product, SUM(sales) AS total_sales
    FROM sales
    WHERE date = CURRENT_DATE
    GROUP BY product
    """
    cursor.execute(query)
    results = cursor.fetchall()
    columns = [desc[0] for desc in cursor.description]
    df = pd.DataFrame(results, columns=columns)
    cursor.close()
    conn.close()
    return df

@op
def transform_to_csv(context, sales_data):
    csv_path = "/tmp/sales_report.csv"
    sales_data.to_csv(csv_path, index=False)
    logger.info(f"CSV report saved to {csv_path}")
    return csv_path

@op
def generate_pdf_chart(context, sales_data):
    pdf_path = "/tmp/sales_chart.pdf"
    sales_data.plot(kind='bar', x='product', y='total_sales', legend=False)
    plt.title("Daily Sales by Product")
    plt.xlabel("Product")
    plt.ylabel("Total Sales")
    plt.savefig(pdf_path)
    plt.close()
    logger.info(f"PDF chart saved to {pdf_path}")
    return pdf_path

@op(required_resource_keys={"smtp"})
def email_sales_report(context, csv_path, pdf_path):
    smtp_config = context.resources.smtp
    msg = MIMEMultipart()
    msg['From'] = smtp_config["email"]
    msg['To'] = "management@company.com"
    msg['Subject'] = "Daily Sales Report"
    body = "Please find attached the daily sales report and chart."
    msg.attach(MIMEText(body, 'plain'))

    with open(csv_path, "rb") as file:
        part = MIMEApplication(file.read(), Name=os.path.basename(csv_path))
        part['Content-Disposition'] = f'attachment; filename="{os.path.basename(csv_path)}"'
        msg.attach(part)

    with open(pdf_path, "rb") as file:
        part = MIMEApplication(file.read(), Name=os.path.basename(pdf_path))
        part['Content-Disposition'] = f'attachment; filename="{os.path.basename(pdf_path)}"'
        msg.attach(part)

    with smtplib.SMTP(smtp_config["smtp_server"], smtp_config["smtp_port"]) as server:
        server.starttls()
        server.login(smtp_config["email"], smtp_config["password"])
        server.sendmail(smtp_config["email"], "management@company.com", msg.as_string())
    logger.info("Email sent successfully")

@job(
    resource_defs={
        "postgres_db": postgres_db_resource,
        "smtp": smtp_resource
    },
    retry_policy=RetryPolicy(max_retries=2, delay=300)
)
def daily_sales_reporting_job():
    sales_data = query_sales_data()
    csv_path = transform_to_csv(sales_data)
    pdf_path = generate_pdf_chart(sales_data)
    email_sales_report(csv_path, pdf_path)

@daily_schedule(
    pipeline_name="daily_sales_reporting_job",
    start_date="2024-01-01",
    execution_time="00:00",
    execution_timezone="UTC",
    tags={"dagster/is_partitioned": "true"},
    solid_selection=None,
    mode="default",
    should_execute=None,
    environment_vars=None,
    partition_days_offset=0,
    end_date=None,
    cron_schedule="0 0 * * *",
    execution_timezone="UTC",
    name="daily_sales_reporting_schedule",
    description="Daily sales reporting pipeline",
    tags_fn=None,
    execution_fn=None,
    partitions_def=None,
    default_status="RUNNING",
    job=None,
    tags_dict=None,
    tags_fn_for_partition_set=None,
    tags_fn_for_schedule=None,
    tags_fn_for_sensor=None,
    tags_fn_for_job=None,
    tags_fn_for_pipeline=None,
    tags_fn_for_graph=None,
    tags_fn_for_op=None,
    tags_fn_for_asset=None,
    tags_fn_for_source_asset=None,
    tags_fn_for_schedule_or_sensor=None,
    tags_fn_for_job_or_pipeline=None,
    tags_fn_for_graph_or_op=None,
    tags_fn_for_asset_or_source_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource=None,
    tags_fn_for_schedule_or_sensor_or_job_or_pipeline_or_graph_or_op_or_asset_or_source_asset_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or_asset_or_source_asset_or_partition_or_partition_set_or_resource_or_op_or