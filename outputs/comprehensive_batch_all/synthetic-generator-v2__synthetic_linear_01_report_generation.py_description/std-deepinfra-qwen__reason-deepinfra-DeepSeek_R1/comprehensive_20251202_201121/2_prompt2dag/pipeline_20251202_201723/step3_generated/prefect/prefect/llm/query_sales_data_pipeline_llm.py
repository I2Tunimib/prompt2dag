# Generated by Prefect 2.x Code Generator
# Date: [Current Date]
# Prefect Version: 2.14.0

from prefect import flow, task, get_run_logger
from prefect.task_runners import SequentialTaskRunner
from prefect.blocks.system import Secret
from prefect.filesystems import LocalFileSystem
from prefect.deployments import Deployment
from prefect.orion.schemas.schedules import CronSchedule
import pandas as pd
import psycopg2
import matplotlib.pyplot as plt
import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.base import MIMEBase
from email.mime.text import MIMEText
from email.utils import COMMASPACE
from email import encoders
import os

# Task: Query Sales Data
@task(retries=2)
def query_sales_data():
    logger = get_run_logger()
    logger.info("Querying sales data from PostgreSQL database...")
    postgres_secret = Secret.load("postgres_default")
    conn = psycopg2.connect(postgres_secret.get())
    query = "SELECT * FROM sales;"
    df = pd.read_sql_query(query, conn)
    conn.close()
    logger.info("Sales data queried successfully.")
    return df

# Task: Transform to CSV
@task(retries=2)
def transform_to_csv(df):
    logger = get_run_logger()
    logger.info("Transforming data to CSV format...")
    local_filesystem = LocalFileSystem.load("local_filesystem")
    file_path = local_filesystem.basepath / "sales_data.csv"
    df.to_csv(file_path, index=False)
    logger.info(f"Data transformed and saved to {file_path}.")
    return file_path

# Task: Generate PDF Chart
@task(retries=2)
def generate_pdf_chart(file_path):
    logger = get_run_logger()
    logger.info("Generating PDF chart from CSV data...")
    df = pd.read_csv(file_path)
    plt.figure(figsize=(10, 5))
    plt.plot(df['date'], df['sales'])
    plt.title('Daily Sales Report')
    plt.xlabel('Date')
    plt.ylabel('Sales')
    pdf_path = file_path.with_suffix('.pdf')
    plt.savefig(pdf_path)
    logger.info(f"PDF chart generated and saved to {pdf_path}.")
    return pdf_path

# Task: Email Sales Report
@task(retries=2)
def email_sales_report(pdf_path):
    logger = get_run_logger()
    logger.info("Emailing sales report...")
    email_secret = Secret.load("email_system")
    email_config = email_secret.get()
    sender = email_config['sender']
    receivers = email_config['receivers']
    subject = "Daily Sales Report"
    body = "Please find the attached daily sales report."

    msg = MIMEMultipart()
    msg['From'] = sender
    msg['To'] = COMMASPACE.join(receivers)
    msg['Subject'] = subject
    msg.attach(MIMEText(body))

    with open(pdf_path, "rb") as attachment:
        part = MIMEBase("application", "octet-stream")
        part.set_payload(attachment.read())
        encoders.encode_base64(part)
        part.add_header(
            "Content-Disposition",
            f"attachment; filename= {pdf_path.name}",
        )
        msg.attach(part)

    with smtplib.SMTP(email_config['smtp_server'], email_config['smtp_port']) as server:
        server.starttls()
        server.login(email_config['smtp_user'], email_config['smtp_password'])
        server.sendmail(sender, receivers, msg.as_string())

    logger.info("Sales report emailed successfully.")

# Flow: query_sales_data_pipeline
@flow(name="query_sales_data_pipeline", task_runner=SequentialTaskRunner())
def query_sales_data_pipeline():
    logger = get_run_logger()
    logger.info("Starting query_sales_data_pipeline...")

    df = query_sales_data()
    csv_file_path = transform_to_csv(df)
    pdf_file_path = generate_pdf_chart(csv_file_path)
    email_sales_report(pdf_file_path)

    logger.info("query_sales_data_pipeline completed successfully.")

# Deployment Configuration
if __name__ == "__main__":
    deployment = Deployment.build_from_flow(
        flow=query_sales_data_pipeline,
        name="query_sales_data_pipeline_deployment",
        work_pool_name="default-agent-pool",
        schedule=CronSchedule(cron="0 0 * * *", timezone="UTC", catchup=False),
    )
    deployment.apply()
```
This code defines a Prefect 2.x flow named `query_sales_data_pipeline` that performs the following tasks in a sequential manner:
1. Queries sales data from a PostgreSQL database.
2. Transforms the queried data into a CSV file.
3. Generates a PDF chart from the CSV data.
4. Emails the final report to management.

The flow is scheduled to run daily at midnight UTC and is configured to use a sequential task runner. Each task has a retry mechanism in case of failure. The deployment is configured to use a default agent pool and is applied when the script is executed.