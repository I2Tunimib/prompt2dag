# Generated by Prefect 2.x Code Generator
# Generation Metadata
# - Name: query_sales_data_pipeline
# - Description: Comprehensive pipeline that generates daily sales reports by querying PostgreSQL sales data, transforming it into CSV format, creating a PDF chart visualization, and emailing the final report to management.
# - Pattern: sequential
# - Schedule Configuration: @daily, UTC, catchup=False
# - Prefect Version: 2.14.0

from prefect import flow, task, get_run_logger
from prefect.task_runners import SequentialTaskRunner
from prefect.deployments import Deployment
from prefect.infrastructure.docker import DockerContainer
from prefect.blocks.system import Secret
from prefect.filesystems import LocalFileSystem
from prefect_email import EmailServerCredentials, email_send_message
import pandas as pd
import matplotlib.pyplot as plt
import os

# Load secrets and resources
postgres_default = Secret.load("postgres_default")
local_filesystem = LocalFileSystem.load("local_filesystem")
email_system = EmailServerCredentials.load("email_system")

@task(retries=2, name="Query Sales Data")
def query_sales_data():
    logger = get_run_logger()
    logger.info("Querying sales data from PostgreSQL database...")
    # Example query (replace with actual query)
    query = "SELECT * FROM sales;"
    db_url = postgres_default.get()
    df = pd.read_sql(query, db_url)
    logger.info("Sales data queried successfully.")
    return df

@task(retries=2, name="Transform to CSV")
def transform_to_csv(df):
    logger = get_run_logger()
    logger.info("Transforming data to CSV format...")
    csv_path = os.path.join(local_filesystem.basepath, "sales_report.csv")
    df.to_csv(csv_path, index=False)
    logger.info(f"CSV file saved to {csv_path}.")
    return csv_path

@task(retries=2, name="Generate PDF Chart")
def generate_pdf_chart(csv_path):
    logger = get_run_logger()
    logger.info("Generating PDF chart from CSV data...")
    df = pd.read_csv(csv_path)
    plt.figure(figsize=(10, 5))
    plt.plot(df['date'], df['sales'])
    plt.title("Sales Report")
    plt.xlabel("Date")
    plt.ylabel("Sales")
    pdf_path = os.path.join(local_filesystem.basepath, "sales_report.pdf")
    plt.savefig(pdf_path)
    logger.info(f"PDF chart saved to {pdf_path}.")
    return pdf_path

@task(retries=2, name="Email Sales Report")
def email_sales_report(pdf_path):
    logger = get_run_logger()
    logger.info("Emailing sales report...")
    subject = "Daily Sales Report"
    message = "Please find the attached sales report."
    email_system.email_send_message(
        email_to="management@example.com",
        subject=subject,
        message=message,
        attachments=[pdf_path]
    )
    logger.info("Sales report emailed successfully.")

@flow(name="query_sales_data_pipeline", task_runner=SequentialTaskRunner, schedule="@daily", timezone="UTC", catchup=False)
def query_sales_data_pipeline():
    logger = get_run_logger()
    logger.info("Starting query_sales_data_pipeline...")
    df = query_sales_data()
    csv_path = transform_to_csv(df)
    pdf_path = generate_pdf_chart(csv_path)
    email_sales_report(pdf_path)
    logger.info("query_sales_data_pipeline completed successfully.")

if __name__ == "__main__":
    deployment = Deployment.build_from_flow(
        flow=query_sales_data_pipeline,
        name="query_sales_data_pipeline_deployment",
        work_pool_name="default-agent-pool",
        version="1.0",
        parameters={},
        tags=["sales", "reporting"],
    )
    deployment.apply()
```
```python
# This is a placeholder for the actual deployment application.
# To deploy the flow, run the following command:
# prefect deployment apply query_sales_data_pipeline_deployment.yaml