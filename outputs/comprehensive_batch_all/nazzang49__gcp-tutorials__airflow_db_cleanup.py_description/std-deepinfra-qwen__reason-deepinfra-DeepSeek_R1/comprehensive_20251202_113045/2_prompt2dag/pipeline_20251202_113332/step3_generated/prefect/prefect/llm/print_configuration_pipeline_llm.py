# Generated by Prefect 2.x Code Generator
# Date: 2023-10-05
# Prefect Version: 2.14.0

from prefect import flow, task, get_run_logger
from prefect.task_runners import SequentialTaskRunner
from prefect.deployments import Deployment
from prefect.infrastructure.docker import DockerContainer
from prefect.blocks.system import Secret
from prefect.orion.schemas.schedules import CronSchedule

# Load secrets
airflow_metastore = Secret.load("airflow-metastore")
airflow_variables = Secret.load("airflow-variables")
xcom = Secret.load("xcom")

@task(retries=1, name="Print Configuration")
def print_configuration():
    """
    Task to print configuration details.
    """
    logger = get_run_logger()
    logger.info("Airflow MetaStore: %s", airflow_metastore.get())
    logger.info("Airflow Variables: %s", airflow_variables.get())
    logger.info("Airflow XCom: %s", xcom.get())

@task(retries=1, name="Cleanup Airflow MetaDB")
def cleanup_airflow_metadb():
    """
    Task to clean up the Airflow MetaDB.
    """
    logger = get_run_logger()
    logger.info("Cleaning up Airflow MetaDB...")
    # Add cleanup logic here
    logger.info("Airflow MetaDB cleanup completed.")

@flow(name="print_configuration_pipeline", task_runner=SequentialTaskRunner)
def print_configuration_pipeline():
    """
    Main flow for the print_configuration_pipeline.
    """
    print_configuration()
    cleanup_airflow_metadb()

# Schedule configuration
schedule = CronSchedule(cron="0 0 * * *", timezone="UTC", start_date=None, end_date=None, catchup=False)

# Deployment configuration
deployment = Deployment.build_from_flow(
    flow=print_configuration_pipeline,
    name="print_configuration_pipeline_deployment",
    work_pool_name="default-agent-pool",
    schedule=schedule,
)

if __name__ == "__main__":
    deployment.apply()