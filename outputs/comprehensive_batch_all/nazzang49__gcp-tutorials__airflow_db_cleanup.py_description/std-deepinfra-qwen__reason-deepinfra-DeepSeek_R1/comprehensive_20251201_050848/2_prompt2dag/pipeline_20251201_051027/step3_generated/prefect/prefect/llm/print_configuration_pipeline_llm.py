# Generated by Prefect 2.x Code Generator
# Date: 2023-10-04
# Prefect Version: 2.14.0
# Flow Name: print_configuration_pipeline
# Deployment Name: print_configuration_pipeline_deployment
# Work Pool: default-agent-pool
# Task Runner: SequentialTaskRunner

import prefect
from prefect import flow, task, get_run_logger
from prefect.tasks import task_input_hash
from prefect.blocks.system import Secret
from prefect.infrastructure.docker import DockerContainer
from prefect.deployments import Deployment
from prefect.orion.schemas.schedules import CronSchedule
from prefect.task_runners import SequentialTaskRunner

# Secrets
airflow_metastore = Secret.load("airflow-metastore")
airflow_variables = Secret.load("airflow-variables")
email_alerts = Secret.load("email-alerts")

@task(retries=1, retry_delay_seconds=10)
def print_configuration():
    """
    Task to print configuration details.
    """
    logger = get_run_logger()
    logger.info("Printing configuration details...")
    logger.info(f"Airflow MetaStore: {airflow_metastore.get()}")
    logger.info(f"Airflow Variables: {airflow_variables.get()}")
    logger.info(f"Email Alerts: {email_alerts.get()}")

@task(retries=1, retry_delay_seconds=10)
def cleanup_airflow_metadb():
    """
    Task to clean up the Airflow MetaDB.
    """
    logger = get_run_logger()
    logger.info("Cleaning up Airflow MetaDB...")
    # Example command to clean up the MetaDB
    # This is a placeholder and should be replaced with actual cleanup logic
    cleanup_command = "echo 'Cleaning up Airflow MetaDB...'"
    result = subprocess.run(cleanup_command, shell=True, check=True, capture_output=True)
    logger.info(f"Cleanup result: {result.stdout.decode()}")

@flow(name="print_configuration_pipeline", task_runner=SequentialTaskRunner(), schedule=CronSchedule(cron="0 0 * * *", timezone="UTC", catchup=False))
def print_configuration_pipeline():
    """
    Flow to print configuration details and clean up the Airflow MetaDB.
    """
    print_configuration_result = print_configuration()
    cleanup_airflow_metadb(wait_for=[print_configuration_result])

if __name__ == "__main__":
    Deployment.build_from_flow(
        flow=print_configuration_pipeline,
        name="print_configuration_pipeline_deployment",
        work_pool_name="default-agent-pool",
    )